<!DOCTYPE HTML>
<!--
	Story by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Born.</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<script src='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
</head>
<!-- paris : 48.860033 2.340371 -->

<body>

	<!-- Wrapper -->
	<div id="wrapper" class="divided">

		<!-- One -->
		<section class="banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right">
			<div id="sectionChange" class="content">
				<h1>Born.</h1>


				<p class="major">Décidez où seront installées les futurs bornes de recharge de la ville de Paris. Un servive proposé par <img style="margin-bottom:-6px"
					 width="200" src="images/logo_mairie_de_paris.jpg" /></p>

				<ul class="actions vertical">
					<li><a onclick="changePage(1)" href="#first" class="button big wide smooth-scroll-middle">Continuer</a></li>
				</ul>
			</div>
			<div id="map" class="image">

			</div>
			<script>
				mapboxgl.accessToken = 'pk.eyJ1IjoibHVjYXNjb2xvbWVyIiwiYSI6ImNqNGhmMTU5ZzAyOWYycW1rbWNneXF6ZHYifQ.OV_aDIpZ9VLqLQrib1qiTA';
				var map = new mapboxgl.Map({
					center: [2.340371, 48.860033],
					zoom: 11,
					container: 'map',
					style: 'mapbox://styles/mapbox/light-v9'
				});
				var rawFile = new XMLHttpRequest();
				rawFile.open("GET", 'http://0.0.0.0:8080/api/v1/prospectives', false);
				rawFile.onreadystatechange = function () {
					var prospectives = JSON.parse(rawFile.response);
					updateProspecView(prospectives);
				}
				rawFile.send(null);

				function updateProspecView(prop) {
					var geo = [];
					prop.forEach((elem) => {
						console.log(elem);
						geo.push({
							"type": "FeatureCollection",
							"features": [
								{
									"type": "Feature",
									"properties": {
										"message": "Foo",
										"iconSize": [32, 32]
									},
									"geometry": {
										"type": "Point",
										"coordinates": [
											elem.lng,
											elem.lat
										]
									}
								}
							]
						})
					});
					geo.forEach(function (features) {
						console.log(features);
						debugger;
						features.features.forEach(function (marker) {
							console.log(marker);
							debugger;
							var el = document.createElement('div');
							el.className = 'marker';
							el.style.backgroundImage = 'url(./images/elec.png)';
							el.style.width = marker.properties.iconSize[0] + 'px';
							el.style.height = marker.properties.iconSize[1] + 'px';

							new mapboxgl.Marker(el, { offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2] })
								.setLngLat(marker.geometry.coordinates)
								.addTo(map);
						});
					});
				}

				function changePage(num) {
					var rawFile = new XMLHttpRequest();
					rawFile.open("GET", 'p'+num+'.html', false);
					rawFile.onreadystatechange = function () {
						if (rawFile.readyState === 4) {
							if (rawFile.status === 200 || rawFile.status == 0) {
								var allText = rawFile.responseText;
								document.getElementById("sectionChange").innerHTML = allText
							}
						}
					}
					rawFile.send(null);
					//document.getElementById("sectionChange").innerHTML = '<object type="text/html" data="p1.html" ></object>';
				}

				function getLocation() {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(showPosition);
					} else {
						alert("Geolocation is not supported by this browser.");
					}
				}
				function showPosition(position) {
					var geojson = {
						"type": "FeatureCollection",
						"features": [
							{
								"type": "Feature",
								"properties": {
									"message": "Foo",
									"iconSize": [20, 20]
								},
								"geometry": {
									"type": "Point",
									"coordinates": [
										position.coords.longitude,
										position.coords.latitude
									]
								}
							}
						]
					};
					geojson.features.forEach(function (marker) {
						var el = document.createElement('div');
						el.className = 'marker';
						el.style.backgroundImage = 'url(./images/marker.png)';
						el.style.width = marker.properties.iconSize[0] + 'px';
						el.style.height = marker.properties.iconSize[1] + 'px';

						new mapboxgl.Marker(el, { offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2] })
							.setLngLat(marker.geometry.coordinates)
							.addTo(map);
					});
					map.flyTo({
						center: [position.coords.longitude, position.coords.latitude],
						zoom: 15,
						bearing: 0,
						speed: 0.8,
						curve: 1,
						easing: function (t) {
							return t;
						}
					});
					//map.zoomTo(15, { duration: 0.5, animate: true });
				}
				getLocation();
			</script>
		</section>



		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/skel.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

</body>

</html>
