<!DOCTYPE HTML>
<!--
	Story by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Born.</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<script src='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
</head>
<!-- paris : 48.860033 2.340371 -->

<body>

	<!-- Wrapper -->
	<div id="wrapper" class="divided">

		<!-- One -->
		<section class="banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right">
			<div id="sectionChange" class="content">
				<h1>Born.</h1>


				<p class="major">Décidez où seront installées les futurs bornes de recharge de la ville de Paris. Un servive proposé par <img style="margin-bottom:-6px"
					 width="200" src="images/logo_mairie_de_paris.jpg" /></p>

				<ul class="actions vertical">
					<li><a onclick="changePage(1)" href="#first" class="button big wide smooth-scroll-middle">Continuer</a></li>
				</ul>
			</div>
			<div id="map" class="image">

			</div>
			<script>
				var userMarkerArray = [];
				mapboxgl.accessToken = 'pk.eyJ1IjoibHVjYXNjb2xvbWVyIiwiYSI6ImNqNGhmMTU5ZzAyOWYycW1rbWNneXF6ZHYifQ.OV_aDIpZ9VLqLQrib1qiTA';
				var map = new mapboxgl.Map({
					center: [2.340371, 48.860033],
					zoom: 11,
					container: 'map',
					style: 'mapbox://styles/mapbox/light-v9'
				});
				function addProspect() {
					var rawFile = new XMLHttpRequest();
					rawFile.open("GET", 'http://0.0.0.0:8080/api/v1/prospectives', false);
					rawFile.onreadystatechange = function () {
						var prospectives = JSON.parse(rawFile.response);
						updateProspecView(prospectives);
					}
					rawFile.send(null);
				}

				function updateProspecView(prop) {
					var geo = [];
					prop.forEach((elem) => {
						console.log(elem);
						geo.push({
							"type": "FeatureCollection",
							"features": [
								{
									"type": "Feature",
									"properties": {
										"message": "Foo",
										"iconSize": [20, 20]
									},
									"geometry": {
										"type": "Point",
										"coordinates": [
											elem.lng,
											elem.lat
										]
									}
								}
							]
						})
					});
					geo.forEach(function (features) {
						console.log(features);
						debugger;
						features.features.forEach(function (marker) {
							console.log(marker);
							debugger;
							var el = document.createElement('div');
							el.className = 'marker';
							el.style.backgroundImage = 'url(./images/elec.png)';
							el.style.width = marker.properties.iconSize[0] + 'px';
							el.style.height = marker.properties.iconSize[1] + 'px';

							new mapboxgl.Marker(el, { offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2] })
								.setLngLat(marker.geometry.coordinates)
								.addTo(map);
						});
					});
				}

				function changePage(num) {
					var rawFile = new XMLHttpRequest();
					rawFile.open("GET", 'p' + num + '.html', false);
					rawFile.onreadystatechange = function () {
						if (rawFile.readyState === 4) {
							if (rawFile.status === 200 || rawFile.status == 0) {
								var allText = rawFile.responseText;
								document.getElementById("sectionChange").innerHTML = allText
							}
						}
					}
					rawFile.send(null);
					if (num == 2) {
						showAllUserLocation();
					}
					if (num == 1) {
						addProspect();
					}
				}

				function showAllUserLocation() {
					debugger;
					var userLoc = JSON.parse('[{"lat": 48.862696, "lng": 2.261416}, {"lat": 48.892151, "lng": 2.317798}, {"lat": 48.867777, "lng": 2.315687}, {"lat": 48.900887, "lng": 2.259296}, {"lat": 48.870081, "lng": 2.374859}, {"lat": 48.900441, "lng": 2.351345}, {"lat": 48.887045, "lng": 2.279758}, {"lat": 48.868159, "lng": 2.411214}, {"lat": 48.883179, "lng": 2.361085}, {"lat": 48.848626, "lng": 2.272283}, {"lat": 48.870483, "lng": 2.280583}, {"lat": 48.892246, "lng": 2.329149}, {"lat": 48.877973, "lng": 2.37434}, {"lat": 48.853422, "lng": 2.389252}, {"lat": 48.88445, "lng": 2.279367}, {"lat": 48.883467, "lng": 2.415119}, {"lat": 48.840051, "lng": 2.325696}, {"lat": 48.861802, "lng": 2.302245}, {"lat": 48.836805, "lng": 2.369625}, {"lat": 48.869072, "lng": 2.374544}, {"lat": 48.832557, "lng": 2.351273}, {"lat": 48.82347, "lng": 2.314331}, {"lat": 48.885103, "lng": 2.26691}, {"lat": 48.879014, "lng": 2.356469}, {"lat": 48.853749, "lng": 2.368188}, {"lat": 48.858422, "lng": 2.303577}, {"lat": 48.879491, "lng": 2.360231}, {"lat": 48.872691, "lng": 2.278701}, {"lat": 48.879039, "lng": 2.260944}, {"lat": 48.880746, "lng": 2.270915}, {"lat": 48.895215, "lng": 2.391023}, {"lat": 48.87432, "lng": 2.422642}, {"lat": 48.864568, "lng": 2.286549}, {"lat": 48.821685, "lng": 2.389979}, {"lat": 48.892631, "lng": 2.338912}, {"lat": 48.892025, "lng": 2.284284}, {"lat": 48.835823, "lng": 2.3084}, {"lat": 48.852392, "lng": 2.296864}, {"lat": 48.862923, "lng": 2.377367}, {"lat": 48.86442, "lng": 2.386329}, {"lat": 48.839057, "lng": 2.297016}, {"lat": 48.882979, "lng": 2.347234}, {"lat": 48.894798, "lng": 2.263868}, {"lat": 48.865394, "lng": 2.36577}, {"lat": 48.888221, "lng": 2.405425}, {"lat": 48.829598, "lng": 2.385801}, {"lat": 48.833139, "lng": 2.363587}, {"lat": 48.8662, "lng": 2.404672}, {"lat": 48.844675, "lng": 2.399164}, {"lat": 48.893182, "lng": 2.27464}, {"lat": 48.86687, "lng": 2.406798}, {"lat": 48.872723, "lng": 2.265854}, {"lat": 48.851114, "lng": 2.277265}, {"lat": 48.823329, "lng": 2.288394}, {"lat": 48.839651, "lng": 2.268699}, {"lat": 48.835258, "lng": 2.413638}, {"lat": 48.859865, "lng": 2.333539}, {"lat": 48.855126, "lng": 2.321704}, {"lat": 48.875063, "lng": 2.358895}, {"lat": 48.821762, "lng": 2.380249}, {"lat": 48.892592, "lng": 2.263713}, {"lat": 48.834295, "lng": 2.364377}, {"lat": 48.842329, "lng": 2.420506}, {"lat": 48.874318, "lng": 2.316626}, {"lat": 48.892493, "lng": 2.414197}, {"lat": 48.829443, "lng": 2.286375}, {"lat": 48.847074, "lng": 2.269593}, {"lat": 48.894587, "lng": 2.380706}, {"lat": 48.824229, "lng": 2.324096}, {"lat": 48.881964, "lng": 2.261562}, {"lat": 48.833732, "lng": 2.371024}, {"lat": 48.863373, "lng": 2.343773}, {"lat": 48.851018, "lng": 2.423293}, {"lat": 48.883113, "lng": 2.279063}, {"lat": 48.8673, "lng": 2.265237}, {"lat": 48.824403, "lng": 2.39754}, {"lat": 48.886596, "lng": 2.393279}, {"lat": 48.866259, "lng": 2.405281}, {"lat": 48.844355, "lng": 2.326722}, {"lat": 48.829588, "lng": 2.390843}, {"lat": 48.867875, "lng": 2.271283}, {"lat": 48.847316, "lng": 2.295333}, {"lat": 48.830252, "lng": 2.303078}, {"lat": 48.887386, "lng": 2.306163}, {"lat": 48.861323, "lng": 2.30202}, {"lat": 48.835837, "lng": 2.382338}, {"lat": 48.849543, "lng": 2.403299}, {"lat": 48.821612, "lng": 2.363905}, {"lat": 48.892597, "lng": 2.331063}, {"lat": 48.845382, "lng": 2.309435}, {"lat": 48.896758, "lng": 2.293547}, {"lat": 48.873312, "lng": 2.30202}, {"lat": 48.835841, "lng": 2.391939}, {"lat": 48.853298, "lng": 2.325857}, {"lat": 48.880968, "lng": 2.257008}, {"lat": 48.865008, "lng": 2.422859}, {"lat": 48.839821, "lng": 2.328509}, {"lat": 48.884146, "lng": 2.340528}, {"lat": 48.834198, "lng": 2.264893}, {"lat": 48.866775, "lng": 2.372245}]');
					var geo = [];
					userLoc.forEach((elem) => {
						console.log(elem);
						geo.push({
							"type": "FeatureCollection",
							"features": [
								{
									"type": "Feature",
									"properties": {
										"message": "Foo",
										"iconSize": [20, 20]
									},
									"geometry": {
										"type": "Point",
										"coordinates": [
											elem.lng,
											elem.lat
										]
									}
								}
							]
						})
					});
					geo.forEach(function (features) {
						features.features.forEach(function (marker) {
							console.log(marker);
							debugger;
							var el = document.createElement('div');
							el.className = 'marker';
							el.style.backgroundImage = 'url(./images/users.png)';
							el.style.width = marker.properties.iconSize[0] + 'px';
							el.style.height = marker.properties.iconSize[1] + 'px';

							var marker = new mapboxgl.Marker(el, { offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2] })
								.setLngLat(marker.geometry.coordinates)
								.addTo(map);
							userMarkerArray.push(marker);
						});
					});
				}

				function getLocation() {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(showPosition);
					} else {
						alert("Geolocation is not supported by this browser.");
					}
				}
				function showPosition(position) {
					var geojson = {
						"type": "FeatureCollection",
						"features": [
							{
								"type": "Feature",
								"properties": {
									"message": "Foo",
									"iconSize": [20, 20]
								},
								"geometry": {
									"type": "Point",
									"coordinates": [
										position.coords.longitude,
										position.coords.latitude
									]
								}
							}
						]
					};
					geojson.features.forEach(function (marker) {
						var el = document.createElement('div');
						el.className = 'marker';
						el.style.backgroundImage = 'url(./images/marker.png)';
						el.style.width = marker.properties.iconSize[0] + 'px';
						el.style.height = marker.properties.iconSize[1] + 'px';

						new mapboxgl.Marker(el, { offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2] })
							.setLngLat(marker.geometry.coordinates)
							.addTo(map);
					});
					map.flyTo({
						center: [position.coords.longitude, position.coords.latitude],
						zoom: 13,
						bearing: 0,
						speed: 0.8,
						curve: 1,
						easing: function (t) {
							return t;
						}
					});
					//map.zoomTo(15, { duration: 0.5, animate: true });
				}
				getLocation();
			</script>
		</section>



		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/skel.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

</body>

</html>